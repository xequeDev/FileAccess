var FileAccess=function(){var e=this;this.bufferObject={},this.bufferSize=0,this.copyObject={},this.standardFileObject={getName:function(){return this.handle.name},getType:function(){return"file"},getSize:async function(){return(await this.handle.getFile()).size},getParent:function(){return this.folder},getPath:function(){return this.path},getExtensions:function(){return this.handle.name.split(".")},delete:function(){var e="This "+this.getType()+" cannot be removed";0==type||void 0==type?this.handle.remove():1==type?this.folder.handle.removeEntry(this.name):console.error(e)},cut:async function(e){var t=this;this.copy().then(function(a){t.delete(e)})},copy:async function(){var t=await (await this.handle.getFile()).arrayBuffer();e.copyObject={handle:t,folder:"root",name:this.getName(),type:this.getType()}},buffer:async function(){var t=await (await this.handle.getFile()).arrayBuffer();e.bufferObject={handle:t,folder:"root",name:this.getName(),type:this.getType()}},move:function(e){if(0==type||void 0==type)this.handle.move(e.handle);else if(1==type){var t=this;this.buffer().then(function(a){t.delete(1),e.place()})}},rename:async function(t,a){if(0==a||void 0==a)this.handle.move(t);else if(1==a){var i=this;this.buffer().then(async function(a){i.delete(1);var n=await (await (await i.folder).getFileHandle(t,{create:!0})).createWritable();await n.write(e.bufferObject.handle),await n.close()})}},write:async function(e){var t=await this.handle.createWritable();await t.write(e),await t.close()},read:async function(){return await this.handle.getFile()},save:async function(e){var t={};void 0!=e&&(t={excludeAcceptAllOption:e.filter,suggestedName:e.name,types:e.accept});var a=await window.showSaveFilePicker(t),i=await (await this.handle.getFile()).arrayBuffer(),n=await a.createWritable();await n.write(i),await n.close()},download:async function(e){this.read().then(function(t){var a=document.createElement("a");a.download=e,a.href=URL.createObjectURL(t),a.click()})}},this.standardFolderObject={getName:function(){return this.handle.name},getType:function(){return"folder"},getSize:async function(){return e.bufferSize=0,await e.measureFolder(this)},getParent:function(){return this.folder},getPath:function(){return this.path},delete:function(e){var t="This "+this.getType()+" cannot be removed";0==e||void 0==e?this.handle.remove():1==e?this.folder.handle.removeEntry(this.name,{recursive:!0}):console.error(t)},cut:async function(e){var t=this;this.copy().then(function(){t.delete(e)})},copy:async function(){e.copyObject={handle:"virtual",folder:"root",name:this.getName(),type:this.getType(),entries:await e.copyFolder(this.handle)}},paste:async function(t){if("folder"==e.copyObject.type){var a=await this.handle.getDirectoryHandle(void 0==t?e.copyObject.name+" (copy)":t,{create:!0});await e.pasteFolder(a,e.copyObject)}else{var a=await this.handle,i=await (await a.getFileHandle(e.copyObject.name,{create:!0})).createWritable();await i.write(e.copyObject.handle),await i.close()}},buffer:async function(){e.bufferObject={handle:"virtual",folder:"root",name:this.getName(),type:this.getType(),entries:await e.copyFolder(this.handle)}},place:async function(){if("folder"==e.bufferObject.type){var t=await this.handle.getDirectoryHandle(e.bufferObject.name,{create:!0});await e.pasteFolder(t,e.bufferObject)}else{var t=await this.handle,a=await (await t.getFileHandle(e.bufferObject.name,{create:!0})).createWritable();await a.write(e.bufferObject.handle),await a.close()}},rename:async function(t,a){if(0==a||void 0==a)this.handle.move(t);else if(1==a){var i=this;this.buffer().then(async function(){i.delete(1),await e.pasteFolder(await i.folder.getDirectoryHandle(t,{create:!0}),e.bufferObject)})}},update:async function(){this.entries.length=0,this.entries=await e.sweepFolder(this.handle),await e.fillFolder(this)},new:async function(e,t,a){if("folder"==e&&await this.handle.getDirectoryHandle(t,{create:!0}),"file"==e)var i=await this.handle.getFileHandle(t,{create:!0});if((void 0==e||void 0==t)&&console.error("This folder cannot create "+e+"s"),void 0!=a){var n=await i.createWritable();await n.write(a),await n.close()}},move:function(e,t){if(0==t||void 0==t)this.handle.move(e.handle);else if(1==t){var a=this;this.buffer().then(function(t){a.delete(1),e.place()})}},save:async function(t){var a=await e.openFolder(t);await this.buffer(),a.place()},download:async function(t){var a=new FileZip;await e.zipFolder(this,await a.new("folder",this.getName()));var i=await a.generate(),n=document.createElement("a");n.download=t,n.href=URL.createObjectURL(i),n.click()}},this.openFile=async function(t){var a={};void 0!=t&&(a={multiple:t.multiple,excludeAcceptAllOption:t.filter,types:t.accept});var i=await window.showOpenFilePicker(a),n=[];if(!(i.length>1))return{handle:i[0],folder:"root",path:["root"],...Object.assign({},e.standardFileObject)};for(var r in i)n.push({handle:i[r],folder:"root",path:["root"],...Object.assign({},e.standardFileObject)});return n},this.openFolder=async function(t){var a={};void 0!=t&&(a={id:t.id,mode:t.mode,startIn:t.init});var i=await window.showDirectoryPicker(a),n={handle:i,folder:"root",path:["root"],entries:await e.sweepFolder(i),...Object.assign({},e.standardFolderObject)};return await e.fillFolder(n),n},this.pasteFolder=async function(t,a){for(var i in a.entries)if("folder"==a.entries[i].type)await e.pasteFolder(await t.getDirectoryHandle(a.entries[i].getName(),{create:!0}),a.entries[i]);else if("file"==a.entries[i].type){var n=await (await t.getFileHandle(a.entries[i].getName(),{create:!0})).createWritable();await n.write(a.entries[i].handle),await n.close()}},this.copyFolder=async function(t){var a=[];for await(var[i,n]of t)if("directory"==n.kind)a.push({handle:"virtual",folder:t.name,name:i,type:"folder",entries:await e.copyFolder(n)});else if("file"==n.kind){var r=await (await n.getFile()).arrayBuffer();a.push({handle:r,folder:t.name,name:i,type:"file"})}return a},this.sweepFolder=async function(t){var a=[];for await(var[i,n]of t)"directory"==n.kind?a.push({handle:n,entries:await e.sweepFolder(n),...Object.assign({},e.standardFolderObject)}):"file"==n.kind&&a.push({handle:n,...Object.assign({},e.standardFileObject)});return a},this.fillFolder=async function(t){for(var a in t.entries)"directory"==t.entries[a].handle.kind?(t.entries[a].folder=t,t.entries[a].path=[...t.path,t],await e.fillFolder(t.entries[a])):"file"==t.entries[a].handle.kind&&(t.entries[a].folder=t,t.entries[a].path=[...t.path,t])},this.measureFolder=async function(t){for(var a in t.entries)if("directory"==t.entries[a].handle.kind)await e.measureFolder(t.entries[a]);else if("file"==t.entries[a].handle.kind){var i=await t.entries[a].handle.getFile();e.bufferSize+=i.size}return e.bufferSize},this.zipFolder=async function(t,a){for(var i in t.entries)"directory"==t.entries[i].handle.kind?await e.zipFolder(t.entries[i],await a.new("folder",t.entries[i].handle.name)):"file"==t.entries[i].handle.kind&&await a.new("file",t.entries[i].handle.name,await t.entries[i].handle.getFile())}};
